import{s as e,D as t,M as o,n as r}from"./utils.min.js";const _={API_BASE_URL:"/api",CDN_BASE_URL:"",DEFAULT_LANG:"es",FALLBACK_LANGS:["en"],MARKET_CSV_URL:"https://api.datawars2.ie/gw2/v1/items/csv",GW2_API_KEY:"",priceCacheStrategy:"sessionStorage",FEATURE_USE_PRECOMPUTED:!1,FEATURE_MARKET_CSV_EXTERNAL:!0,FEATURE_MARKET_CSV_EXTERNAL_WORKER:!1,FEATURE_DONES_AGGREGATE:!1,PRECOMPUTED_CANARY_THRESHOLD:1,FETCH_GUARD_MODE:"enforce",FETCH_GUARD_WHITELIST:[],CONNECT_ALLOWLIST:[],FETCH_GUARD_REPORT_URL:null,FEATURE_ITEM_API_ROLLOUT:!1,CANARY_ASSIGNMENTS:{},CANARY_ROLLOUTS:null};function E(e,t=!1){if("boolean"==typeof e)return e;if(null==e)return t;if("number"==typeof e)return Number.isNaN(e)?t:0!==e;const o=String(e).trim().toLowerCase();return o?!!["1","true","yes","on"].includes(o)||!["0","false","no","off"].includes(o)&&t:t}function A(e,t){if(t&&"object"==typeof t){if(Object.prototype.hasOwnProperty.call(t,"API_BASE_URL")&&null!=t.API_BASE_URL&&(e.API_BASE_URL=t.API_BASE_URL),Object.prototype.hasOwnProperty.call(t,"CDN_BASE_URL")&&null!=t.CDN_BASE_URL&&(e.CDN_BASE_URL=t.CDN_BASE_URL),Object.prototype.hasOwnProperty.call(t,"DEFAULT_LANG")&&t.DEFAULT_LANG&&(e.DEFAULT_LANG=t.DEFAULT_LANG),Object.prototype.hasOwnProperty.call(t,"LANG")&&t.LANG&&(e.DEFAULT_LANG=t.LANG),Object.prototype.hasOwnProperty.call(t,"MARKET_CSV_URL")&&t.MARKET_CSV_URL&&(e.MARKET_CSV_URL=t.MARKET_CSV_URL),Object.prototype.hasOwnProperty.call(t,"GW2_API_KEY")&&null!=t.GW2_API_KEY&&(e.GW2_API_KEY=t.GW2_API_KEY),Object.prototype.hasOwnProperty.call(t,"priceCacheStrategy")&&t.priceCacheStrategy?e.priceCacheStrategy=t.priceCacheStrategy:Object.prototype.hasOwnProperty.call(t,"PRICE_CACHE_STRATEGY")&&t.PRICE_CACHE_STRATEGY&&(e.priceCacheStrategy=t.PRICE_CACHE_STRATEGY),Object.prototype.hasOwnProperty.call(t,"FEATURE_USE_PRECOMPUTED")&&(e.FEATURE_USE_PRECOMPUTED=t.FEATURE_USE_PRECOMPUTED),Object.prototype.hasOwnProperty.call(t,"FEATURE_MARKET_CSV_EXTERNAL")?e.FEATURE_MARKET_CSV_EXTERNAL=t.FEATURE_MARKET_CSV_EXTERNAL:Object.prototype.hasOwnProperty.call(t,"FEATURE_MARKET_CSV_INTERNAL")&&(e.FEATURE_MARKET_CSV_EXTERNAL=!E(t.FEATURE_MARKET_CSV_INTERNAL,!0)),Object.prototype.hasOwnProperty.call(t,"FEATURE_MARKET_CSV_EXTERNAL_WORKER")&&(e.FEATURE_MARKET_CSV_EXTERNAL_WORKER=t.FEATURE_MARKET_CSV_EXTERNAL_WORKER),Object.prototype.hasOwnProperty.call(t,"FEATURE_DONES_AGGREGATE")&&(e.FEATURE_DONES_AGGREGATE=t.FEATURE_DONES_AGGREGATE),Object.prototype.hasOwnProperty.call(t,"FEATURE_ITEM_API_ROLLOUT")&&(e.FEATURE_ITEM_API_ROLLOUT=t.FEATURE_ITEM_API_ROLLOUT),Object.prototype.hasOwnProperty.call(t,"PRECOMPUTED_CANARY_THRESHOLD")&&(e.PRECOMPUTED_CANARY_THRESHOLD=t.PRECOMPUTED_CANARY_THRESHOLD),Object.prototype.hasOwnProperty.call(t,"FETCH_GUARD_MODE")&&"string"==typeof t.FETCH_GUARD_MODE&&(e.FETCH_GUARD_MODE=t.FETCH_GUARD_MODE),Object.prototype.hasOwnProperty.call(t,"FETCH_GUARD_WHITELIST")){const o=t.FETCH_GUARD_WHITELIST;if(Array.isArray(o))e.FETCH_GUARD_WHITELIST=[...o];else if("string"==typeof o){const t=o.split(",").map(e=>e.trim()).filter(Boolean);e.FETCH_GUARD_WHITELIST=t}}if(Object.prototype.hasOwnProperty.call(t,"CONNECT_ALLOWLIST")&&Array.isArray(t.CONNECT_ALLOWLIST)&&(e.CONNECT_ALLOWLIST=[...t.CONNECT_ALLOWLIST]),Object.prototype.hasOwnProperty.call(t,"FALLBACK_LANGS")){const o=t.FALLBACK_LANGS;Array.isArray(o)?e.FALLBACK_LANGS=[...o]:"string"==typeof o&&(e.FALLBACK_LANGS=o.split(",").map(e=>e.trim()).filter(Boolean))}else if(Object.prototype.hasOwnProperty.call(t,"FALLBACK_LANG")){const o=t.FALLBACK_LANG;"string"==typeof o&&(e.FALLBACK_LANGS=o.split(",").map(e=>e.trim()).filter(Boolean))}if(Object.prototype.hasOwnProperty.call(t,"FETCH_GUARD_REPORT_URL")){const o=t.FETCH_GUARD_REPORT_URL;null!=o&&"string"!=typeof o||(e.FETCH_GUARD_REPORT_URL=o)}Object.prototype.hasOwnProperty.call(t,"CANARY_ASSIGNMENTS")&&(e.CANARY_ASSIGNMENTS=t.CANARY_ASSIGNMENTS),Object.prototype.hasOwnProperty.call(t,"CANARY_ROLLOUTS")?e.CANARY_ROLLOUTS=t.CANARY_ROLLOUTS:Object.prototype.hasOwnProperty.call(t,"CANARY_THRESHOLDS")&&(e.CANARY_ROLLOUTS=t.CANARY_THRESHOLDS)}}function n(e){if(null==e)return null;const t=Number(e);if(!Number.isFinite(t))return null;const r=Math.floor(t);return r<0?0:r>o?o:r}function s(){const o={..._,FETCH_GUARD_WHITELIST:[..._.FETCH_GUARD_WHITELIST],CONNECT_ALLOWLIST:[..._.CONNECT_ALLOWLIST]},s=("undefined"!=typeof globalThis?globalThis.window&&"object"==typeof globalThis.window?globalThis.window:globalThis.self&&"object"==typeof globalThis.self?globalThis.self:globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0)||("undefined"!=typeof globalThis?globalThis:void 0),R=s&&"object"==typeof s.Config?s.Config:null,l=s&&"object"==typeof s.__RUNTIME_CONFIG__?s.__RUNTIME_CONFIG__:null,i=s&&"object"==typeof s.__SECURE_RUNTIME_CONFIG__?s.__SECURE_RUNTIME_CONFIG__:null,c=function({legacy:e,runtime:t,secureRuntime:o,globalScope:r}){const _=[o&&(o.DEBUG_RUNTIME??o.DEBUG),t&&(t.DEBUG_RUNTIME??t.DEBUG),e&&(e.DEBUG_RUNTIME??e.DEBUG),r&&(r.__RUNTIME_DEBUG__??r.__DEBUG__)];for(const e of _)if(void 0!==e)return E(e,!1);if(r&&r.location&&"string"==typeof r.location.search){const e=String(r.location.search||"");if(e)try{const t=new URLSearchParams(e.startsWith("?")?e.slice(1):e),o=["debugRuntime","runtimeDebug","debug-config"];for(const e of o)if(t.has(e)){const o=t.get(e);return E(null==o||o,!0)}}catch(t){if(/[?&](debugRuntime|runtimeDebug|debug-config)(?:=|&|$)/i.test(e))return!0}}return!1}({legacy:R,runtime:l,secureRuntime:i,globalScope:s});A(o,R),A(o,l),A(o,i),o.FEATURE_USE_PRECOMPUTED=E(o.FEATURE_USE_PRECOMPUTED,_.FEATURE_USE_PRECOMPUTED),o.FEATURE_MARKET_CSV_EXTERNAL=E(o.FEATURE_MARKET_CSV_EXTERNAL,_.FEATURE_MARKET_CSV_EXTERNAL),o.FEATURE_MARKET_CSV_EXTERNAL_WORKER=E(o.FEATURE_MARKET_CSV_EXTERNAL_WORKER,_.FEATURE_MARKET_CSV_EXTERNAL_WORKER),o.FEATURE_ITEM_API_ROLLOUT=E(o.FEATURE_ITEM_API_ROLLOUT,_.FEATURE_ITEM_API_ROLLOUT);const a=Number(o.PRECOMPUTED_CANARY_THRESHOLD);o.PRECOMPUTED_CANARY_THRESHOLD=Number.isFinite(a)?Math.min(Math.max(a,0),100):_.PRECOMPUTED_CANARY_THRESHOLD;const T=Array.isArray(o.FALLBACK_LANGS)?o.FALLBACK_LANGS:"string"==typeof o.FALLBACK_LANGS?o.FALLBACK_LANGS.split(","):[];if(null!=o.CDN_BASE_URL&&""!==o.CDN_BASE_URL){const e=String(o.CDN_BASE_URL).trim().replace(/\/$/,"");o.CDN_BASE_URL=e}else o.CDN_BASE_URL="";const L=String(o.DEFAULT_LANG||_.DEFAULT_LANG).trim().toLowerCase();o.FALLBACK_LANGS=[...new Set(T.map(e=>"string"==typeof e?e.trim().toLowerCase():"").filter(e=>e&&e!==L))],o.LANG=o.DEFAULT_LANG||_.DEFAULT_LANG;const p=String(o.LANG||"").trim().toLowerCase();o.FALLBACK_LANGS=o.FALLBACK_LANGS.filter(e=>e&&e!==p);const O=e(o.CANARY_ASSIGNMENTS,{source:"runtime-config"});if(o.CANARY_ASSIGNMENTS=function(e){const t={};if(!e||"object"!=typeof e)return t;for(const[o,r]of Object.entries(e))o&&r&&"object"==typeof r&&(t[o]={...r});return t}(O),o.CANARY_ROLLOUTS=function(e,o){const E=n(null!=o?o:_.PRECOMPUTED_CANARY_THRESHOLD),A={scope:t,threshold:E},s={default:{...A},features:{},screens:{},scopes:{[t]:{...A}}},R=e=>{const o=n(e);null!=o&&(s.default.threshold=o,s.scopes[t]={scope:t,threshold:o})},l=(e,t)=>{const o=n(t);if(null==o)return;const _=r({feature:e});if(!_||!_.startsWith("feature:"))return;const E=_.slice(8),A={scope:_,threshold:o,name:"string"==typeof e&&e?e:E};s.features[E]=A,s.scopes[_]=A},i=(e,t)=>{const o=n(t);if(null==o)return;const _=r({screen:e});if(!_||!_.startsWith("screen:"))return;const E=_.slice(7),A={scope:_,threshold:o,name:"string"==typeof e&&e?e:E};s.screens[E]=A,s.scopes[_]=A},c=(e,o)=>{const _=n(o);if(null==_)return;const E=r(e);E&&(E!==t?E.startsWith("feature:")?l(E.slice(8),_):E.startsWith("screen:")?i(E.slice(7),_):s.scopes[E]={scope:E,threshold:_}:R(_))},a=e=>{if(null!=e)if("number"!=typeof e&&"string"!=typeof e){if(Array.isArray(e))e.forEach(a);else if("object"==typeof e){if(Object.prototype.hasOwnProperty.call(e,"default")&&R(e.default),Object.prototype.hasOwnProperty.call(e,"features")){const t=e.features;if(t&&"object"==typeof t)for(const[e,o]of Object.entries(t))o&&"object"==typeof o&&!Array.isArray(o)?l(e,o.threshold??o.value??o.bucket??o.rollout):l(e,o)}if(Object.prototype.hasOwnProperty.call(e,"screens")||Object.prototype.hasOwnProperty.call(e,"pages")){const t=e.screens||e.pages;if(t&&"object"==typeof t)for(const[e,o]of Object.entries(t))o&&"object"==typeof o&&!Array.isArray(o)?i(e,o.threshold??o.value??o.bucket??o.rollout):i(e,o)}if(Object.prototype.hasOwnProperty.call(e,"scopes")){const t=e.scopes;if(t&&"object"==typeof t)for(const[e,o]of Object.entries(t))o&&"object"==typeof o&&!Array.isArray(o)?c(e,o.threshold??o.value??o.bucket??o.rollout):c(e,o)}for(const[t,o]of Object.entries(e))["default","features","screens","pages","scopes"].includes(t)||c(t,o)}}else R(e)};return a(e),s}(o.CANARY_ROLLOUTS,o.PRECOMPUTED_CANARY_THRESHOLD),!o.CANARY_ROLLOUTS.scopes[t]){const e={scope:t,threshold:o.PRECOMPUTED_CANARY_THRESHOLD};o.CANARY_ROLLOUTS.scopes[t]=e,o.CANARY_ROLLOUTS.default=e}return function({debugMode:e,legacy:t,runtime:o,secureRuntime:r}){if(!e||"undefined"==typeof console||null===console)return;const _=new Date,E={legacyConfig:Boolean(t),runtimeConfig:Boolean(o),secureRuntimeConfig:Boolean(r),runtimeLoadedAt:o&&Object.prototype.hasOwnProperty.call(o,"__loadedAt")?o.__loadedAt:null,configInitializedAt:_.toISOString()};if(!o)return void console.warn("[runtime-config][debug] runtime-env.js was not available during config initialization.",E);if(!Object.prototype.hasOwnProperty.call(o,"__loadedAt"))return void console.warn('[runtime-config][debug] runtime-env.js missing "__loadedAt" marker; verify load order.',E);const A="string"==typeof o.__loadedAt?Date.parse(o.__loadedAt):Number.isFinite(o.__loadedAt)?Number(o.__loadedAt):Number.NaN;if(Number.isNaN(A))return void console.warn('[runtime-config][debug] runtime-env.js has an invalid "__loadedAt" timestamp.',E);const n=_.getTime()-A;E.runtimeLoadedDeltaMs=n,n<-50?console.warn("[runtime-config][debug] runtime-env.js appears to have executed after config.js. Ensure /runtime-env.js loads first.",E):console.info("[runtime-config][debug] runtime configuration applied successfully.",{...E,lang:o.LANG,flags:o.FLAGS})}({debugMode:c,legacy:R,runtime:l,secureRuntime:i}),o}export{s as g};
