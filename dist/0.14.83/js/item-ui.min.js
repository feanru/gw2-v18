import{setQtyInputValue as t,showSkeleton as e,hideSkeleton as o,showError as a,hideError as n,getQtyInputValue as l}from"./ui-helpers.min.js";import{i as d,C as i,D as s,E as r}from"./utils.min.js";import"./config.min.js";import"./services.min.js";const c=new Map;let m=!1;function u(t){const e=c.get(t);if(!e||e.loaded||e.loading)return;if(!function(t){const e=document.getElementById(t);return Boolean(e&&e.classList.contains("active"))}(t))return;e.loading=!0;const o=o=>{!1===o?(e.loaded=!1,function(t,e){e&&(e.retryTimeout||(e.retryTimeout=setTimeout(()=>{e.retryTimeout=null,u(t)},300)))}(t,e)):e.loaded=!0},a=()=>{e.loading=!1};try{const n=e.loader();n&&"function"==typeof n.then?n.then(t=>{o(t)}).catch(o=>{console.error(`Error cargando contenido para la pesta√±a ${t}`,o),e.loaded=!1}).finally(()=>{a()}):(o(n),a())}catch(o){console.error(`Error cargando contenido para la pesta√±a ${t}`,o),e.loaded=!1,a()}}function p(t,e){t&&"function"==typeof e&&(c.set(t,{loader:e,loaded:!1,loading:!1,retryTimeout:null}),function(){if(m)return;m=!0,document.addEventListener("tabchange",t=>{const e=t?.detail?.tabId;e&&u(e)});const t=()=>{c.forEach((t,e)=>{u(e)})};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",t,{once:!0}):t()}(),u(t))}function f(t,e=1,o=null,a=0,n=!0,l=[]){return t.map((t,d)=>{const i=0===e?d:a,s=i%2==0?"row-bg-a":"row-bg-b",r=e>0?`style="padding-left:${30*e}px"`:"";t.id;const c=[...l,t._uid].join("-"),m=t.is_craftable&&t.children&&t.children.length?`<button class="btn-expand-path" data-path="${c}">${t.expanded?"-":"+"}</button>`:"",u=e>0,p=u?`child-of-${o}`:"",y=u&&!n?'style="display:none"':"",v=!t.buy_price&&!t.sell_price,b=t.is_craftable&&t.children&&t.children.length>0,h=0===e||b&&(v||null!=t.total_crafted)||!b&&null!=t.total_crafted,g="function"==typeof getRarityClass?getRarityClass(t.rarity):"";return`\n      <tr data-state-id="${t._uid}" data-path="${c}" class="${u?`subrow subrow-${e} ${p}`:""} ${s}" ${y}>\n        <td class="th-border-left-items" ${r}><img data-src="${t.icon}" width="32" class="lazy-img" alt=""></td>\n        <td><a href="/item?id=${t.id}" class="item-link ${g}" target="_blank">${t.name}</a></td>\n        <td>${null!=t.countTotal?t.countTotal:t.count}</td>\n        <td class="item-solo-buy">\n          <div>${formatGoldColored(t.total_buy)}</div>\n          <div class="item-solo-precio">${formatGoldColored(t.buy_price)} <span style="color: #c99b5b">c/u</span></div>\n          ${u?`<input type="radio" name="mode-${t._uid}" class="chk-mode-buy" data-uid="${t._uid}" ${"buy"===t.modeForParentCrafted?"checked":""} title="Usar precio de compra para el padre">`:""}\n        </td>\n        <td class="item-solo-sell">\n          <div>${formatGoldColored(t.total_sell)}</div>\n          <div class="item-solo-precio">${formatGoldColored(t.sell_price)} <span style="color: #c99b5b">c/u</span></div>\n          ${u?`<input type="radio" name="mode-${t._uid}" class="chk-mode-sell" data-uid="${t._uid}" ${"sell"===t.modeForParentCrafted?"checked":""} title="Usar precio de venta para el padre">`:""}\n        </td>\n        <td class="item-solo-crafted">\n          ${h?`<div>${formatGoldColored(t.total_crafted||0)}</div><div class="item-solo-precio">${formatGoldColored(0)} <span style="color:#c99b5b">c/u</span></div>`+(u?`<input type="radio" name="mode-${t._uid}" class="chk-mode-crafted" data-uid="${t._uid}" ${"crafted"===t.modeForParentCrafted?"checked":""} title="Usar precio de crafteo para el padre">`:""):""}\n        </td>\n        <td class="th-border-right-items">${m}</td>\n      </tr>\n      ${t.is_craftable&&t.children&&t.children.length&&n&&t.expanded?f(t.children,e+1,t.id,i,t.expanded,[...l,t._uid]):""}\n    `}).join("")}function y(t){if(!t)return"";let e={totalBuy:0,totalSell:0},o=0;if(t.children&&t.children.length>0){const t=getTotals();e.totalBuy=t.totalBuy,e.totalSell=t.totalSell,o=t.totalCrafted}const a={totalBuy:e.totalBuy,totalSell:e.totalSell,totalCrafted:null!=t.total_crafted?t.total_crafted:o},n=t.buy_price||0,l=t.sell_price||0,d="function"==typeof getRarityClass?getRarityClass(t.rarity):"",i=`<button class="btn-expand-path" data-path="${t._uid}">${t.expanded?"-":"+"}</button>`;return`\n    <tr data-state-id="${t._uid}" data-path="${t._uid}" data-item-id="${t.id}" class="ingred-row ${t.expanded?"expanded":""}">\n      \x3c!-- Col 1: √çcono (SIN colspan) --\x3e\n      <td class="th-border-left-items">\n        <img src="${t.icon}" width="32">\n      </td>\n\n      \x3c!-- Col 2: Nombre --\x3e\n      <td>\n        <span class="item-link ${d}">${t.name}</span>\n      </td>\n\n      \x3c!-- Col 3: Cantidad --\x3e\n      <td>${null!=t.countTotal?t.countTotal:t.count}</td>\n\n      \x3c!-- Col 4: Total Compra --\x3e\n      <td class="item-solo-buy">\n        <div>${formatGoldColored(a.totalBuy)}</div>\n        <div class="item-solo-precio">${formatGoldColored(n)} <span style="color:#c99b5b">c/u</span></div>\n      </td>\n\n      \x3c!-- Col 5: Total Venta --\x3e\n      <td class="item-solo-sell">\n        <div>${formatGoldColored(a.totalSell)}</div>\n        <div class="item-solo-precio">${formatGoldColored(l)} <span style="color:#c99b5b">c/u</span></div>\n      </td>\n\n      \x3c!-- Col 6: Total Crafteo --\x3e\n      <td class="item-solo-crafted">\n        <div>${formatGoldColored(a.totalCrafted)}</div>\n        <div class="item-solo-precio">${formatGoldColored(0)} <span style="color:#c99b5b">c/u</span></div>\n      </td>\n\n      \x3c!-- Col 7: Bot√≥n (alineado con hijos) --\x3e\n      <td class="th-border-right-items">${i}</td>\n    </tr>\n  `}function v(){const t=window.ingredientObjs||[];let e=1;const o=t.length>0?t[0]:null;o&&o.recipe&&o.recipe.output_item_count&&!isNaN(o.recipe.output_item_count)?e=o.recipe.output_item_count:window._mainRecipeOutputCount&&!isNaN(window._mainRecipeOutputCount)&&(e=window._mainRecipeOutputCount);let a={totalBuy:0,totalSell:0,totalCrafted:0};const n=getTotals?getTotals():null;n&&(Number.isFinite(n.totalBuy)&&(a.totalBuy=n.totalBuy),Number.isFinite(n.totalSell)&&(a.totalSell=n.totalSell),Number.isFinite(n.totalCrafted)&&(a.totalCrafted=n.totalCrafted));let i=null;o&&o.children&&o.children.length>0&&(i=getTotals(),a.totalBuy=i.totalBuy,a.totalSell=i.totalSell),o&&(a.totalCrafted=null!=o.total_crafted?o.total_crafted:i?i.totalCrafted:0);const s=void 0!==l()?l():window.globalQty;d("usePrecomputed")&&(a.totalBuy*=s,a.totalSell*=s,a.totalCrafted*=s);const r=(o&&"number"==typeof o.buy_price?o.buy_price:window._mainBuyPrice||0)*s,c=(o&&"number"==typeof o.sell_price?o.sell_price:window._mainSellPrice||0)*s,m=Math.min(a.totalBuy,a.totalSell,a.totalCrafted),u=[r,c,m],p=u.filter(t=>"number"==typeof t&&t>0),v=p.length?Math.min(...p):null,b=null!=v?u.indexOf(v):-1;let h="Sin datos de mercado";0===b?h="Mejor comprar (Buy)":1===b?h="Mejor vender (Sell)":2===b&&(h="Mejor craftear (Crafteo)");let g="";o&&(g+=y(o),g+=f(o.children,1,null,0,!!o.expanded,[o._uid]));let _="",$="";if(c>0){const t=c-.15*c,o=t-a.totalBuy,n=t-a.totalSell,l=t-a.totalCrafted;if(1===e&&(_=`<section id='profit-section'><br>\n        <div class="table-modern-totales">\n        <div class="titulo-con-ayuda">\n          <div class="ayuda-tooltip">?\n            <span class="tooltiptext-modern"> Esta secci√≥n muestra la ganancia estimada al vender el √≠tem despu√©s de craftearlo. Se calcula como: (Precio venta - 15% comisi√≥n) - costo total de crafteo. Tambi√©n muestra 3 posibles resultados dependiendo de la forma de craftear.</span>\n          </div>\n          <h3>Profit si se craftea y se vende (ganancia estimada)</h3>\n        </div>\n        <table class='table-totales totales-crafting-comparativa' style='margin-bottom: 8px;'>\n          <tr style='text-align:center;'>\n            <td><div class='base-comparativa'>${formatGoldColored(Math.round(o))} <br><span style='font-size:0.93em;'>Profit "Comprar"</span></div></td>\n            <td><div class='base-comparativa'>${formatGoldColored(Math.round(n))} <br><span style='font-size:0.93em;'>Profit "Vender"</span></div></td>\n            <td><div class='base-comparativa'>${formatGoldColored(Math.round(l))} <br><span style='font-size:0.93em;'>Profit "Craftear"</span></div></td>\n          </tr>\n          <tr><td colspan='3' style='text-align:center;font-size:0.98em;color:#a1a1aa;'>La ganancia se calcula como: (Precio venta - 15% comisi√≥n) - costo total</td></tr>\n        </table>\n      </div>\n      </section>`),e>1){const t=null!=_mainSellPrice?_mainSellPrice:0,o=t-.15*t,n=o-a.totalBuy/e,l=o-a.totalSell/e,d=o-a.totalCrafted/e;$=`<section id='profit-section-unidad'><br>\n        <div class="table-modern-totales">          \n        <h3>Profit si se craftea y se vende por UNIDAD (ganancia estimada)</h3>\n        <div style='margin-bottom:8px;color:#a1a1aa;font-size:1em;'>Esta receta produce <b>${e}</b> unidades por crafteo. Los siguientes c√°lculos son por unidad.</div>\n        <table class='table-totales totales-crafting-comparativa' style='margin-bottom: 8px;'>\n          <tr style='text-align:center;'>\n            <td><div class='base-comparativa'>${formatGoldColored(Math.round(n))} <br><span style='font-size:0.93em;'>Profit "Comprar"</span></div></td>\n            <td><div class='base-comparativa'>${formatGoldColored(Math.round(l))} <br><span style='font-size:0.93em;'>Profit "Vender"</span></div></td>\n            <td><div class='base-comparativa'>${formatGoldColored(Math.round(d))} <br><span style='font-size:0.93em;'>Profit "Craftear"</span></div></td>\n          </tr>\n          <tr><td colspan='3' style='text-align:center;font-size:0.98em;color:#a1a1aa;'>La ganancia por unidad se calcula como: (Precio venta unitario - 15% comisi√≥n) - costo unitario</td></tr>\n        </table>\n      </div>\n      </section>`}}let w=`<div id="qty-global-container" style="margin:18px 0 18px 0;display:flex;align-items:center;gap:12px;">\n    <label for="qty-global" style="font-weight:500;">Cantidad global:</label>\n    <input id="qty-global" type="number" min="1" value="${s}" style="width:60px;height:36px;" autocomplete="off">\n  </div>`,C=`<div class="table-modern-totales">\n    <div class="titulo-con-ayuda">\n      <div class="ayuda-tooltip">?\n        <span class="tooltiptext-modern">Esta secci√≥n muestra el costo total de los materiales necesarios para craftear el √≠tem. Con costo de materiales en venta directa, pedido y crafteo de sus propio materiales.</span>\n      </div>\n      <h3>Precio total materiales - Crafting</h3>\n    </div>\n    <div id="totales-crafting">      \n      <table class="table-totales" style="margin-top:12px;">\n        <tr>\n          <th><div class="tooltip-modern">Total Compra\n            <span class="tooltiptext-modern">Suma total si haces PEDIDO de materiales en el mercado.</span>\n          </div></th>\n          <td class="item-solo-buy">${formatGoldColored(a.totalBuy)} </td>\n          <th><div class="tooltip-modern">Total Venta\n            <span class="tooltiptext-modern">Suma total si COMPRAS materiales en el mercado.</span>\n          </div></th>\n          <td class="item-solo-sell">${formatGoldColored(a.totalSell)}</td>\n          <th><div class="tooltip-modern">Total Crafteo\n            <span class="tooltiptext-modern">Suma total si CRAFTEAS todos los materiales posibles desde cero.</span>\n          </div></th>\n          <td class="item-solo-crafted">${formatGoldColored(a.totalCrafted)}</td>\n        </tr>\n      </table>\n    </div>\n    </div>`,x="";e>1&&(x=`<div class="table-modern-totales">\n    <div class="titulo-con-ayuda">\n      <div class="ayuda-tooltip">?\n        <span class="tooltiptext-modern">Muestra el costo por unidad ya que esta receta produce m√∫ltiples √≠tems</span>\n      </div>\n      <h3>Costos por unidad (${e} unidades por crafteo)</h3>\n    </div>\n    <div style='margin-bottom:8px;color:#a1a1aa;font-size:1em;'>Esta receta produce <b>${e}</b> unidades por crafteo.</div>\n      <div id="totales-crafting">\n        <table class="table-totales" style="margin-top:12px;">\n          <tr>\n            <th><div class="tooltip-modern">Total Compra\n              <span class="tooltiptext-modern">Suma total si haces PEDIDO de materiales en el mercado.</span>\n            </div></th>\n            <td class="item-solo-buy">${formatGoldColored(a.totalBuy/e)}</td>\n            <th><div class="tooltip-modern">Total Venta\n              <span class="tooltiptext-modern">Suma total si COMPRAS materiales en el mercado.</span>\n            </div></th>\n            <td class="item-solo-sell">${formatGoldColored(a.totalSell/e)}</td>\n            <th><div class="tooltip-modern">Total Crafteo\n              <span class="tooltiptext-modern">Suma total si CRAFTEAS todos los materiales posibles desde cero.</span>\n            </div></th>\n            <td class="item-solo-crafted">${formatGoldColored(a.totalCrafted/e)}</td>\n          </tr>\n        </table>\n      </div>\n    </div>`);let S="",q="",T=h;if(1===e&&(S=`<section id='comparativa-section'>\n      <div class="table-modern-totales">\n        <div class="titulo-con-ayuda">\n          <div class="ayuda-tooltip">?\n            <span class="tooltiptext-modern"> Esta secci√≥n compara el precio de compra directa y pedido en el mercado con el costo de crafteo m√°s bajo.</span>\n          </div>\n          <h3>Comparativa de precios de Bazar vs Crafting</h3>\n        </div>\n        <br>\n        <table class='table-totales totales-crafting-comparativa'>\n          <tr style='text-align:center;'>\n            <td><div class='base-comparativa' style='${0===b?"background:#e84d4d33;":""}'>${formatGoldColored(r)} <br><span style='font-size:0.93em;'>Precio compra</span></div></td>\n            <td><div class='base-comparativa' style='${1===b?"background:#4db1e833;":""}'>${formatGoldColored(c)} <br><span style='font-size:0.93em;'>Precio venta</span></div></td>\n            <td><div class='base-comparativa' style='${2===b?"background:#4fc17833;":""}'>${formatGoldColored(m)} <br><span style='font-size:0.93em;'>Precio crafting m√°s bajo</span></div></td>\n          </tr>\n          <tr><td colspan='3' style='text-align:center;font-size:1.07em;'>${h}</td></tr>\n        </table>\n      </div>\n      </section>`),e>1){const t=window.globalQty||1,o=null!=_mainBuyPrice?_mainBuyPrice*t:0,a=null!=_mainSellPrice?_mainSellPrice*t:0,n=e>0?m/e:m,l=[o,a,n],d=l.filter(t=>"number"==typeof t&&t>0),i=d.length?Math.min(...d):null,s=null!=i?l.indexOf(i):-1;T="Sin datos de mercado",0===s?T="Mejor comprar (Buy)":1===s?T="Mejor vender (Sell)":2===s&&(T="Mejor craftear (Crafteo)"),q=`<section id='comparativa-section-unidad'>\n      <div class="table-modern-totales"><br>\n        <h3>Comparativa de precios de Bazar vs Crafting por UNIDAD</h3>\n        <div style='margin-bottom:8px;color:#a1a1aa;font-size:1em;'>Esta receta produce <b>${e}</b> unidades por crafteo. Los siguientes precios son por unidad.</div>\n        <table class='table-totales totales-crafting-comparativa'>\n          <tr style='text-align:center;'>\n            <td><div style='${0===s?"background:#e84d4d33;font-weight:bold;border-radius:6px;padding:10px;":""}'>${formatGoldColored(o)} <br><span style='font-size:0.93em;'>Precio compra</span></div></td>\n            <td><div style='${1===s?"background:#4db1e833;font-weight:bold;border-radius:6px;padding:10px;":""}'>${formatGoldColored(a)} <br><span style='font-size:0.93em;'>Precio venta</span></div></td>\n            <td><div style='${2===s?"background:#4fc17833;font-weight:bold;border-radius:6px;padding:10px;":""}'>${formatGoldColored(n)} <br><span style='font-size:0.93em;'>Precio crafting m√°s bajo</span></div></td>\n          </tr>\n          <tr><td colspan='3' style='text-align:center;font-size:1.07em;'>${T}</td></tr>\n        </table>\n      </div>\n      </section>`}return`\n    ${w}\n    <table class="table-modern tabla-tarjetas">\n      <thead class="header-items">\n        <tr>\n          <th class="th-border-left">√çcono</th>\n          <th>Nombre</th>\n          <th>Cantidad</th>\n          <th>Total Compra</th>\n          <th>Total Venta</th>\n          <th>Total Crafteo</th>\n          <th class="th-border-right"></th>\n        </tr>\n      </thead>\n      \x3c!-- üëá Aqu√≠ va la tabla correcta: root + hijos --\x3e\n      <tbody>${g}</tbody>\n    </table>\n    ${C}\n    ${e>1?x:""}\n    ${S}\n    ${e>1?q:""}\n    ${_}\n    ${e>1?$:""}\n  `}async function b(t,e){const a=document.getElementById("item-header");let n="";if(t.details?.disciplines?.length>0||t.details?.min_rating>0){const e={Artificer:"Artesano",Armorsmith:"Armero",Chef:"Cocinero",Huntsman:"Cazador",Jeweler:"Joyero",Leatherworker:"Peletero",Tailor:"Sastre",Weaponsmith:"Armero de armas",Scribe:"Escriba"},o=(t.details.disciplines||[]).map(t=>e[t]||t);n=`\n      <div style="margin-top: 4px; color: #a1a1aa; font-size: 0.95rem;">\n        ${t.details.min_rating?`<span style="color: #16c198; font-weight: 500;">Nivel:</span> ${t.details.min_rating} `:""}\n        ${o.length>0?`<span style="color: #16c198; font-weight: 500;">${t.details.min_rating?"‚Ä¢ ":""}Disciplinas:</span> ${o.join(", ")}`:""}\n      </div>\n    `}const l="function"==typeof getRarityClass?getRarityClass(t.rarity):"";a.innerHTML=`\n    <img src="${t.icon}" alt=""/>\n    <div>\n      <h2 class="${l}">${t.name}</h2>\n      <div style="color:#a1a1aa;font-size:1.05rem;">\n        ID: ${t.id} &nbsp;|&nbsp; ${t.type} ${t.rarity?" - "+t.rarity:""}\n      </div>\n      ${n}\n    </div>\n  `,formatGoldColored(e.buy_price),formatGoldColored(e.sell_price),e.sell_quantity,e.buy_quantity;const d=document.getElementById("resumen-mercado");if(d){d.innerHTML="";const t=document.createElement("div");t.classList.add("skeleton","skeleton-market-summary"),d.appendChild(t),p("resumen-mercado",()=>{o(t),d.querySelector("table")||d.insertAdjacentHTML("beforeend",function(t){return`\n      <table class="table-modern">\n        <tr>\n          <th><div class="dato-item tooltip-modern">Precio de compra\n            <span class="tooltiptext-modern">Precio al que los compradores est√°n dispuestos a adquirir el √≠tem (mejor oferta de compra).</span>\n          </div></th>\n          <td><div class="dato-item-info">${formatGoldColored(t.buy_price)}</div></td>\n        </tr>\n        <tr>\n          <th><div class="dato-item tooltip-modern">Precio de venta\n            <span class="tooltiptext-modern">Precio al que los vendedores ofrecen el √≠tem (mejor oferta de venta).</span>\n          </div></th>\n          <td><div class="dato-item-info">${formatGoldColored(t.sell_price)}</div></td>\n        </tr>\n        <tr>\n          <th><div class="dato-item tooltip-modern">Disponibles para vender\n            <span class="tooltiptext-modern">Cantidad total de √≠tems listados actualmente para vender en el mercado.</span>\n          </div></th>\n          <td><div class="dato-item-info">${t.sell_quantity??"-"}</div></td>\n        </tr>\n        <tr>\n          <th><div class="dato-item tooltip-modern">Disponibles para comprar\n            <span class="tooltiptext-modern">Cantidad total de √≠tems que los compradores buscan adquirir en el mercado.</span>\n          </div></th>\n          <td><div class="dato-item-info">${t.buy_quantity??"-"}</div></td>\n        </tr>\n      </table>\n      <section id="ventas-compras" class="bloque-section">\n        <h3>Ventas y Compras Recientes</h3>\n        <table class="table-modern">\n          <tr><th></th><th style="text-align:center;">1 d√≠a</th><th style="text-align:center;">2 d√≠as</th><th style="text-align:center;">7 d√≠as</th><th style="text-align:center;">1 mes</th></tr>\n          <tr>\n            <th><div class="dato-item tooltip-modern">Ventas\n                <span class="tooltiptext-modern">Cantidad de √≠tems comprados directamente en el periodo (actividad de salida del mercado).</span>\n                </div>\n            </th>\n            <td><div class="dato-item-info">${t["1d_sell_sold"]??"-"}</div></td>\n            <td><div class="dato-item-info">${t["2d_sell_sold"]??"-"}</div></td>\n            <td><div class="dato-item-info">${t["7d_sell_sold"]??"-"}</div></td>\n            <td><div class="dato-item-info">${t["1m_sell_sold"]??"-"}</div></td>\n          </tr>\n          <tr>\n            <th><div class="dato-item tooltip-modern">Compras\n                <span class="tooltiptext-modern">Cantidad de √≠tems vendidos directamente en el periodo (actividad de entrada al mercado).</span>\n                </div></th>\n            <td><div class="dato-item-info">${t["1d_buy_sold"]??"-"}</div></td>\n            <td><div class="dato-item-info">${t["2d_buy_sold"]??"-"}</div></td>\n            <td><div class="dato-item-info">${t["7d_buy_sold"]??"-"}</div></td>\n            <td><div class="dato-item-info">${t["1m_buy_sold"]??"-"}</div></td>\n          </tr>\n          <tr><td colspan="5" style="color:#888;font-size:0.95em;">* Basado en actividad reciente.</td></tr>\n        </table>\n      </section>\n      <section id="porcentajes-rotacion" class="bloque-section">\n        <h3>Porcentajes de Rotaci√≥n</h3>\n        <table class="table-modern">\n          <tr><th></th><th style="text-align:center;">1 d√≠a</th><th style="text-align:center;">2 d√≠as</th><th style="text-align:center;">7 d√≠as</th><th style="text-align:center;">1 mes</th></tr>\n          <tr>\n            <th><div class="dato-item tooltip-modern">Ventas/Supply\n                <span class="tooltiptext-modern">Porcentaje de √≠tems comprados directamente respecto al total disponible (rotaci√≥n de inventario en el mercado).</span>\n                </div></th>\n            <td><div class="dato-item-info">${calcPercent(t["1d_sell_sold"],t.sell_quantity)}</div></td>\n            <td><div class="dato-item-info">${calcPercent(t["2d_sell_sold"],t.sell_quantity)}</div></td>\n            <td><div class="dato-item-info">${calcPercent(t["7d_sell_sold"],t.sell_quantity)}</div></td>\n            <td><div class="dato-item-info">${calcPercent(t["1m_sell_sold"],t.sell_quantity)}</div></td>\n          </tr>\n          <tr>\n            <th><div class="dato-item tooltip-modern">Compras/Demand\n                <span class="tooltiptext-modern">Porcentaje de √≠tems vendidos directamente respecto a la demanda total (flujo de entrada al mercado).</span>\n                </div></th>\n            <td><div class="dato-item-info">${calcPercent(t["1d_buy_sold"],t.buy_quantity)}</div></td>\n            <td><div class="dato-item-info">${calcPercent(t["2d_buy_sold"],t.buy_quantity)}</div></td>\n            <td><div class="dato-item-info">${calcPercent(t["7d_buy_sold"],t.buy_quantity)}</div></td>\n            <td><div class="dato-item-info">${calcPercent(t["1m_buy_sold"],t.buy_quantity)}</div></td>\n          </tr>\n          <tr><td colspan="5" style="color:#888;font-size:0.95em;">* Basado en actividad reciente comparada con la cantidad disponible.</td></tr>\n        </table>\n      </section>\n  `}(e))})}const s=document.getElementById("info-item");s&&(window.ingredientObjs&&window.ingredientObjs.length>0&&await recalcAll(window.ingredientObjs,window.globalQty),s.innerHTML='\n      <div id="seccion-totales"></div>\n      <div id="seccion-comparativa"></div>\n      <div id="seccion-crafting"></div>\n    ',document.getElementById("seccion-totales").innerHTML="",document.getElementById("seccion-comparativa").innerHTML="",document.getElementById("seccion-crafting").innerHTML=v(),document.querySelectorAll("#seccion-crafting tr[data-state-id]").forEach(t=>{const e=t.getAttribute("data-state-id");i(e,t,e=>{const o=t.querySelector(".item-solo-buy");o&&(o.innerHTML=`<div>${formatGoldColored(e.total_buy)}</div><div class="item-solo-precio">${formatGoldColored(e.buy_price)} <span style="color: #c99b5b">c/u</span></div>`);const a=t.querySelector(".item-solo-sell");a&&(a.innerHTML=`<div>${formatGoldColored(e.total_sell)}</div><div class="item-solo-precio">${formatGoldColored(e.sell_price)} <span style="color: #c99b5b">c/u</span></div>`);const n=t.querySelector(".item-solo-crafted");n&&(n.innerHTML=`<div>${formatGoldColored(e.total_crafted||0)}</div><div class="item-solo-precio">${formatGoldColored(0)} <span style="color:#c99b5b">c/u</span></div>`)})}),requestAnimationFrame(()=>{r(),setTimeout(r,0)})),function(t,e=null){if(!t)return;const o=document.getElementById("wiki-links");if(!o)return;const a=encodeURIComponent(t.replaceAll(" ","_")),n="string"==typeof e&&""!==e.trim()?e:t,l=`https://wiki.guildwars2.com/wiki/es:${a}`,d=`https://wiki.guildwars2.com/wiki/${encodeURIComponent(n.replaceAll(" ","_"))}`;o.innerHTML=`\n    <div class="wiki-links">\n      <a href="${l}" target="_blank">Wiki en Espa√±ol</a>\n      <a href="${d}" target="_blank">Wiki en Ingl√©s</a>\n    </div>\n  `}(t.name,t.name_en),h()}function h(){window._uiEventsInstalled||(window._uiEventsInstalled=!0,window._qtyGlobalHandlerInstalled||(window._qtyGlobalHandlerInstalled=!0,document.addEventListener("input",function(t){t.target&&"qty-global"===t.target.id&&(window._qtyInputValue=t.target.value)}),document.addEventListener("blur",function(t){if(t.target&&"qty-global"===t.target.id){const e=t.target;let o=parseInt(e.value,10);isNaN(o)||o<1?(setGlobalQty(1),window._qtyInputValue="1"):(setGlobalQty(o),window._qtyInputValue=e.value),void 0!==window._qtyInputValue&&String(window._qtyInputValue)===String(window.globalQty)&&delete window._qtyInputValue,g()}},!0),document.addEventListener("keydown",function(t){if(t.target&&"qty-global"===t.target.id&&"Enter"===t.key){t.preventDefault();const e=t.target;let o=parseInt(e.value,10);isNaN(o)||o<1?(setGlobalQty(1),window._qtyInputValue="1"):(setGlobalQty(o),window._qtyInputValue=e.value),void 0!==window._qtyInputValue&&String(window._qtyInputValue)===String(window.globalQty)&&delete window._qtyInputValue,g()}})),document.addEventListener("change",async function(t){const e=t.target;if(!e.matches(".chk-mode-buy, .chk-mode-sell, .chk-mode-crafted"))return;const o=e.dataset.uid;if(!o)return;const a=findIngredientByUid(window.ingredientObjs||[],o);a&&(e.classList.contains("chk-mode-buy")?a.modeForParentCrafted="buy":e.classList.contains("chk-mode-sell")?a.modeForParentCrafted="sell":e.classList.contains("chk-mode-crafted")&&(a.modeForParentCrafted="crafted"),await g())}),document.addEventListener("click",function(t){const e=t.target.closest(".btn-expand-path");if(!e)return;const o=e.getAttribute("data-path");if(!o)return;const a=o.split("-").map(t=>t.trim()),n=findIngredientByPath(window.ingredientObjs||[],a);n&&(n.expanded=!n.expanded,g())}))}async function g(){d("usePrecomputed")||"function"!=typeof recalcAll||await recalcAll(window.ingredientObjs||[],window.globalQty);const t=document.getElementById("seccion-crafting");if(t){const e=document.getElementById("qty-global"),o=e?e.value:window.globalQty,a=snapshotExpandState(window.ingredientObjs||[]);t.innerHTML=v(),document.querySelectorAll("#seccion-crafting tr[data-state-id]").forEach(t=>{const e=t.getAttribute("data-state-id");i(e,t,e=>{const o=t.querySelector(".item-solo-buy");if(o){const t=o.querySelector("div:first-child"),a=o.querySelector(".item-solo-precio");t&&(t.innerHTML=formatGoldColored(e.total_buy)),a&&(a.innerHTML=`${formatGoldColored(e.buy_price)} <span style="color: #c99b5b">c/u</span>`)}const a=t.querySelector(".item-solo-sell");if(a){const t=a.querySelector("div:first-child"),o=a.querySelector(".item-solo-precio");t&&(t.innerHTML=formatGoldColored(e.total_sell)),o&&(o.innerHTML=`${formatGoldColored(e.sell_price)} <span style="color: #c99b5b">c/u</span>`)}const n=t.querySelector(".item-solo-crafted");if(n){const t=n.querySelector("div:first-child"),o=n.querySelector(".item-solo-precio");t&&(t.innerHTML=formatGoldColored(e.total_crafted||0)),o&&(o.innerHTML=`${formatGoldColored(0)} <span style="color:#c99b5b">c/u</span>`)}})}),document.querySelectorAll("#totales-crafting").forEach(t=>{const e=t.closest(".table-modern-totales")?.querySelector("h3")?.textContent?.includes("unidad");i(e?"totales-crafting-unit":"totales-crafting-global",t,o=>{const a=e&&window._mainRecipeOutputCount&&!isNaN(window._mainRecipeOutputCount)?window._mainRecipeOutputCount:1,n=t.querySelector(".item-solo-buy");n&&(n.innerHTML=formatGoldColored(o.totalBuy/a));const l=t.querySelector(".item-solo-sell");l&&(l.innerHTML=formatGoldColored(o.totalSell/a));const d=t.querySelector(".item-solo-crafted");d&&(d.innerHTML=formatGoldColored(o.totalCrafted/a))})});const n=getTotals();s("totales-crafting-global",n),s("totales-crafting-unit",n);const l=document.getElementById("qty-global");l&&(l.value=o),restoreExpandState(window.ingredientObjs||[],a),requestAnimationFrame(()=>{r(),setTimeout(r,0)})}}window.safeRenderTable=g,setTimeout(()=>{t(),document.getElementById("qty-global")},0),setTimeout(()=>{h()},0),window.showSkeleton=e,window.hideSkeleton=o,window.showError=a,window.hideError=n,window.renderItemUI=b,window.installUIEvents=h,window.initItemUI=async function(t,e){window._lastItemData=t,window._lastMarketData=e,window._currentItemId=t?.id??null,p("tab-mejores-horas-content",()=>{const e=window._currentItemId||t?.id;return!!e&&("function"!=typeof window.cargarMejoresHorasYMercado?(console.warn("Servicios de mejores horas no disponibles: cargarMejoresHorasYMercado no est√° definido."),!1):window.cargarMejoresHorasYMercado(e))});const a=document.getElementById("item-skeleton");n();try{await b(t,e)}finally{o(a)}};export{y as renderMainItemRow,f as renderRows};
