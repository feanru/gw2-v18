import{c as e,b as t}from"./utils.min.js";import{showSkeleton as i,hideSkeleton as r}from"./ui-helpers.min.js";import"./config.min.js";import"./services.min.js";const n={},o={};async function c(i=[]){if(i.length)try{return void await e(i,{iconCache:n,rarityCache:o})}catch(e){try{const e=await t(`https://api.guildwars2.com/v2/items?ids=${i.join(",")}&lang=es`);(await e.json()).forEach(e=>{e&&e.id&&(n[e.id]=e.icon,o[e.id]=e.rarity)})}catch{}}}async function s(i=[]){if(!i||0===i.length)return new Map;try{const{priceMap:t}=await e(i,{iconCache:n,rarityCache:o});return t}catch(e){const r=`https://api.datawars2.ie/gw2/v1/items/csv?fields=id,buy_price,sell_price&ids=${i.join(",")}`;try{const e=await t(r).then(e=>e.text()),[i,...n]=e.trim().split("\n"),o=i.split(","),c=o.indexOf("id"),s=o.indexOf("buy_price"),a=o.indexOf("sell_price"),l=new Map;return n.forEach(e=>{const t=e.split(","),i=parseInt(t[c],10);isNaN(i)||l.set(i,{buy_price:parseInt(t[s],10)||0,sell_price:parseInt(t[a],10)||0})}),l}catch(e){return new Map}}}function a(e,t){if(!e||!t)return;const i=e.querySelector("div");if(!i||i.querySelector("img"))return;const r=document.createElement("img");r.src=t,r.className="item-icon",i.prepend(r)}"undefined"!=typeof window&&(window.FractalesUtils={fetchIconsFor:c,fetchItemPrices:s,iconCache:n,rarityCache:o});const l={t6:{sangre:24295,hueso:24358,garra:24351,colmillo:24357,escama:24289,totem:24300,veneno:24283},t5:{sangre:24294,hueso:24341,garra:24350,colmillo:24356,escama:24288,totem:24299,veneno:24282},polvo:24277,piedra:20796},u={cores:{glacial:24319,cristal:24329,destructor:24324,cargado:24304,corrupto:24339,onice:24309,fundido:24314},stones:{glacial:24320,cristal:24330,destructor:24325,cargado:24305,corrupto:24340,onice:24310,fundido:24315},polvo:24277,botella:19663,cristal:20799},p={20796:{price:0,missing:!0},19663:{price:2500,missing:!1},20799:{price:0,missing:!0}};function m(e,t,i="buy_price"){if(Object.prototype.hasOwnProperty.call(p,e)){const t=p[e];if(t&&"object"==typeof t){const e="number"==typeof t.price?t.price:null;return{price:e,missing:Boolean(t.missing)||null===e}}return{price:t,missing:!1}}const r=t.get(e);if(!r)return{price:null,missing:!0};const n=r[i];return"number"==typeof n&&n>0?{price:n,missing:!1}:{price:null,missing:!0}}function d(e=[]){let t=0,i=!1;return e.forEach(({priceInfo:e,quantity:r=1})=>{if(!e)return;"number"==typeof e.price&&!Number.isNaN(e.price)&&(i=!0,t+=e.price*r)}),{value:t,missing:!i}}function f(e,t=1){if(!e)return{value:0,missing:!0};const i="number"==typeof e.price&&!Number.isNaN(e.price);return{value:i?e.price*t:0,missing:!i}}function y({value:e,missing:t}){const i="number"==typeof e?e:0,r=window.formatGoldColored(i);return t?`${r} <small class="sin-precio">sin precio</small>`:r}document.addEventListener("DOMContentLoaded",()=>{!async function(){const e=document.getElementById("forja-skeleton"),t=document.getElementById("tabla-forja-mistica");i(e),t&&t.classList.add("hidden");try{const e=Object.keys(l.t5),t=[...e.map(e=>l.t5[e]),...e.map(e=>l.t6[e]),l.polvo,l.piedra],i=await s(t);await c(t),e.forEach(e=>{const t=document.querySelector(`#matt5t6 tr[data-key="${e}"]`);if(!t)return;const r=t.querySelector(".sum-mats"),o=t.querySelector(".resultado"),c=t.querySelector(".profit"),s=m(l.t5[e],i,"buy_price"),u=m(l.t6[e],i,"buy_price"),p=m(l.t6[e],i,"sell_price"),g=d([{priceInfo:s,quantity:50},{priceInfo:m(l.polvo,i,"buy_price"),quantity:5},{priceInfo:m(l.piedra,i,"buy_price"),quantity:5},{priceInfo:u}]),b=f(p,6.91),h={value:.85*b.value,missing:b.missing},v={value:h.value-g.value,missing:h.missing||g.missing};r&&(r.innerHTML=y(g)),o&&(o.innerHTML=y(h)),c&&(c.innerHTML=y(v));const w=t.querySelectorAll("td");a(w[0],n[l.t5[e]]),a(w[1],n[l.t6[e]]),a(w[2],n[l.polvo]),a(w[3],n[l.piedra])})}catch(e){console.error("Error al renderizar la tabla de la forja mística:",e)}finally{r(e),t&&t.classList.remove("hidden")}}(),async function(){const e=document.getElementById("lodestones-skeleton"),t=document.getElementById("tabla-lodestones");i(e),t&&t.classList.add("hidden");try{const e=Object.keys(u.cores),t=[...e.map(e=>u.cores[e]),...e.map(e=>u.stones[e]),u.polvo,u.botella,u.cristal],i=await s(t);await c(t),e.forEach(e=>{const t=document.querySelector(`#tabla-lodestones tr[data-key="${e}"]`);if(!t)return;const r=t.querySelector(".sum-mats"),o=t.querySelector(".profit"),c=m(u.cores[e],i,"buy_price"),s=m(u.stones[e],i,"sell_price"),l=d([{priceInfo:c,quantity:2},{priceInfo:m(u.polvo,i,"buy_price")},{priceInfo:m(u.botella,i,"buy_price")},{priceInfo:m(u.cristal,i,"buy_price")}]),p=f(s,.85),g={value:p.value-l.value,missing:p.missing||l.missing};r&&(r.innerHTML=y(l)),o&&(o.innerHTML=y(g));const b=t.querySelectorAll("td");a(b[0],n[u.cores[e]]),a(b[1],n[u.polvo]),a(b[2],n[u.botella]),a(b[3],n[u.cristal]),a(b[4],n[u.stones[e]])})}catch(e){console.error("Error al renderizar la tabla de piedras imán:",e)}finally{r(e),t&&t.classList.remove("hidden")}}()});
