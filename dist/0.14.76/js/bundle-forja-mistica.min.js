import{c as e,b as i}from"./utils.min.js";import"./services.min.js";import"./config.min.js";const t={},r={};async function n(n=[]){if(n.length)try{return void await e(n,{iconCache:t,rarityCache:r})}catch(e){try{const e=await i(`https://api.guildwars2.com/v2/items?ids=${n.join(",")}&lang=es`);(await e.json()).forEach(e=>{e&&e.id&&(t[e.id]=e.icon,r[e.id]=e.rarity)})}catch{}}}async function c(n=[]){if(!n||0===n.length)return new Map;try{const{priceMap:i}=await e(n,{iconCache:t,rarityCache:r});return i}catch(e){const t=`https://api.datawars2.ie/gw2/v1/items/csv?fields=id,buy_price,sell_price&ids=${n.join(",")}`;try{const e=await i(t).then(e=>e.text()),[r,...n]=e.trim().split("\n"),c=r.split(","),o=c.indexOf("id"),s=c.indexOf("buy_price"),a=c.indexOf("sell_price"),l=new Map;return n.forEach(e=>{const i=e.split(","),t=parseInt(i[o],10);isNaN(t)||l.set(t,{buy_price:parseInt(i[s],10)||0,sell_price:parseInt(i[a],10)||0})}),l}catch(e){return new Map}}}function o(e,i){if(!e||!i)return;const t=e.querySelector("div");if(!t||t.querySelector("img"))return;const r=document.createElement("img");r.src=i,r.className="item-icon",t.prepend(r)}"undefined"!=typeof window&&(window.FractalesUtils={fetchIconsFor:n,fetchItemPrices:c,iconCache:t,rarityCache:r});const s={t6:{sangre:24295,hueso:24358,garra:24351,colmillo:24357,escama:24289,totem:24300,veneno:24283},t5:{sangre:24294,hueso:24341,garra:24350,colmillo:24356,escama:24288,totem:24299,veneno:24282},polvo:24277,piedra:20796},a={cores:{glacial:24319,cristal:24329,destructor:24324,cargado:24304,corrupto:24339,onice:24309,fundido:24314},stones:{glacial:24320,cristal:24330,destructor:24325,cargado:24305,corrupto:24340,onice:24310,fundido:24315},polvo:24277,botella:19663,cristal:20799},l={20796:{price:0,missing:!0},19663:{price:2500,missing:!1},20799:{price:0,missing:!0}};function u(e,i,t="buy_price"){if(Object.prototype.hasOwnProperty.call(l,e)){const i=l[e];if(i&&"object"==typeof i){const e="number"==typeof i.price?i.price:null;return{price:e,missing:Boolean(i.missing)||null===e}}return{price:i,missing:!1}}const r=i.get(e);if(!r)return{price:null,missing:!0};const n=r[t];return"number"==typeof n&&n>0?{price:n,missing:!1}:{price:null,missing:!0}}function p(e=[]){let i=0,t=!1;return e.forEach(({priceInfo:e,quantity:r=1})=>{if(!e)return;"number"==typeof e.price&&!Number.isNaN(e.price)&&(t=!0,i+=e.price*r)}),{value:i,missing:!t}}function m(e,i=1){if(!e)return{value:0,missing:!0};const t="number"==typeof e.price&&!Number.isNaN(e.price);return{value:t?e.price*i:0,missing:!t}}function f({value:e,missing:i}){const t="number"==typeof e?e:0,r=window.formatGoldColored(t);return i?`${r} <small class="sin-precio">sin precio</small>`:r}document.addEventListener("DOMContentLoaded",()=>{!async function(){const e=Object.keys(s.t5),i=[...e.map(e=>s.t5[e]),...e.map(e=>s.t6[e]),s.polvo,s.piedra],r=await c(i);await n(i),e.forEach(e=>{const i=document.querySelector(`#matt5t6 tr[data-key="${e}"]`);if(!i)return;const n=i.querySelector(".sum-mats"),c=i.querySelector(".resultado"),a=i.querySelector(".profit"),l=u(s.t5[e],r,"buy_price"),y=u(s.t6[e],r,"buy_price"),d=u(s.t6[e],r,"sell_price"),g=p([{priceInfo:l,quantity:50},{priceInfo:u(s.polvo,r,"buy_price"),quantity:5},{priceInfo:u(s.piedra,r,"buy_price"),quantity:5},{priceInfo:y}]),b=m(d,6.91),v={value:.85*b.value,missing:b.missing},h={value:v.value-g.value,missing:v.missing||g.missing};n&&(n.innerHTML=f(g)),c&&(c.innerHTML=f(v)),a&&(a.innerHTML=f(h));const w=i.querySelectorAll("td");o(w[0],t[s.t5[e]]),o(w[1],t[s.t6[e]]),o(w[2],t[s.polvo]),o(w[3],t[s.piedra])})}(),async function(){const e=Object.keys(a.cores),i=[...e.map(e=>a.cores[e]),...e.map(e=>a.stones[e]),a.polvo,a.botella,a.cristal],r=await c(i);await n(i),e.forEach(e=>{const i=document.querySelector(`#tabla-lodestones tr[data-key="${e}"]`);if(!i)return;const n=i.querySelector(".sum-mats"),c=i.querySelector(".profit"),s=u(a.cores[e],r,"buy_price"),l=u(a.stones[e],r,"sell_price"),y=p([{priceInfo:s,quantity:2},{priceInfo:u(a.polvo,r,"buy_price")},{priceInfo:u(a.botella,r,"buy_price")},{priceInfo:u(a.cristal,r,"buy_price")}]),d=m(l,.85),g={value:d.value-y.value,missing:d.missing||y.missing};n&&(n.innerHTML=f(y)),c&&(c.innerHTML=f(g));const b=i.querySelectorAll("td");o(b[0],t[a.cores[e]]),o(b[1],t[a.polvo]),o(b[2],t[a.botella]),o(b[3],t[a.cristal]),o(b[4],t[a.stones[e]])})}()});
