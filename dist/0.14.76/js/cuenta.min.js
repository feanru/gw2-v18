import{b as e,n as t}from"./utils.min.js";import"./services.min.js";import"./config.min.js";void 0===window.StorageUtils&&console.error("Error: storageUtils.js no est치 cargado");const n='\n    <ul class="skeleton-items">\n        <li class="skeleton skeleton-item"></li>\n        <li class="skeleton skeleton-item"></li>\n        <li class="skeleton skeleton-item"></li>\n    </ul>';async function o(){const e=await(window.StorageUtils?.getFavoritos())??[],t=await(window.StorageUtils?.getComparativas())??[],n=document.getElementById("favoritosCount");n&&(n.textContent=e.length);const o=document.getElementById("comparacionesCount");o&&(o.textContent=t.length)}async function a(){const n=document.getElementById("favoritos-items-container");if(!n)return void console.error("No se encontr칩 el contenedor de favoritos");const a=await(window.StorageUtils?.getFavoritos())??[],i=new Map,s=a.map(e=>Number(e.id)).filter(e=>Number.isInteger(e)&&e>0);if(s.length)try{const n=await e(`backend/api/itemBundle.php?ids=${s.join(",")}`);if(n.ok){const e=await n.json().catch(()=>null),{data:o}=t(e);Array.isArray(o)&&o.forEach(e=>{e&&"number"==typeof e.id&&i.set(e.id,e)})}else console.warn("No se pudieron obtener los detalles de favoritos",n.status)}catch(e){console.error("Error obteniendo detalles de favoritos",e)}if(!a.length)return void(n.innerHTML='\n            <div class="no-items">\n                <span class="empty-icon" aria-hidden="true">游닍</span>\n                <p>No hay 칤tems guardados a칰n.</p>\n                <p>Guarda 칤tems desde la p치gina de detalles para verlos aqu칤.</p>\n            </div>');const r=document.createElement("ul");r.className="favoritos-list",a.forEach((a,s)=>{const c=document.createElement("li");c.className="favorito-item",c.dataset.id=a.id;const l=document.createElement("img");l.className="favorito-icon";const d=i.get(Number(a.id)),m=d?.item||null;l.src=m?.icon||"img/sphere_5528251.svg",l.alt=m?.name?`Icono de ${m.name}`:"icono",l.width=24,l.height=24;const p=document.createElement("a");p.href=`/item?id=${a.id}`,p.className="favorito-link",a.nombre?p.textContent=a.nombre:m?.name?p.textContent=m.name:(p.innerHTML='<div class="skeleton skeleton-block"></div>',i.size||e(`backend/api/itemDetails.php?itemId=${a.id}`).then(e=>e.ok?e.json():null).then(e=>{const{data:n}=t(e);n?.item&&(n.item.icon&&(l.src=n.item.icon),n.item.name&&(p.textContent=n.item.name))}).catch(e=>console.error("Error fetching item detalles:",e)));const u=document.createElement("span");u.className="favorito-id",u.textContent=`#${a.id}`;const v=document.createElement("button");v.className="delete-favorito",v.title="Eliminar de favoritos",v.innerHTML="&times;",v.onclick=async e=>{e.preventDefault(),e.stopPropagation(),confirm(`쮼liminar "${a.nombre||"este 칤tem"}" de favoritos?`)&&(window.StorageUtils&&window.StorageUtils.removeFavorito&&await window.StorageUtils.removeFavorito(a.id),c.remove(),0===document.querySelectorAll(".favorito-item").length&&(n.innerHTML='\n                        <div class="no-items">\n                            <span class="empty-icon" aria-hidden="true">游닍</span>\n                            <p>No hay 칤tems guardados.</p>\n                        </div>'),window.StorageUtils?.showToast("칈tem eliminado de favoritos"),o())};const g=document.createElement("div");g.className="favorito-content",g.appendChild(l),g.appendChild(p),g.appendChild(u),c.appendChild(g),c.appendChild(v),r.appendChild(c)}),n.innerHTML="",n.appendChild(r);const c=document.createElement("div");c.className="favoritos-counter",c.textContent=`${a.length} ${1===a.length?"칤tem":"칤tems"} guardados`,n.prepend(c),o()}async function i(){const e=document.getElementById("lista-comparaciones");if(!e)return void console.error("No se encontr칩 el contenedor de comparativas");const t=await(window.StorageUtils?.getComparativas())??[];if(!t.length)return void(e.innerHTML='\n            <div class="no-items">\n                <span class="empty-icon" aria-hidden="true">游닍</span>\n                <p>No hay comparativas guardadas.</p>\n                <p>Guarda una comparativa desde la secci칩n de comparativa para verla aqu칤.</p>\n            </div>');const n=document.createElement("ul");n.className="favoritos-list",t.forEach((t,a)=>{const i=document.createElement("li");i.className="favorito-item comparativa-item";const s=document.createElement("span");s.className="favorito-icon",s.innerHTML="游늵";const r=Array.isArray(t.nombres)&&t.nombres.length?t.nombres.join(" vs "):`Comparativa ${a+1}`,c=document.createElement("a");c.href=`/compare-craft?ids=${t.ids.join(",")}`,c.className="favorito-link",c.textContent=r;const l=document.createElement("span");l.className="favorito-id";const d=t.ids.length;l.textContent=`(${d} ${1===d?"칤tem":"칤tems"})`;const m=document.createElement("button");m.className="delete-favorito",m.title="Eliminar comparativa",m.innerHTML="&times;",m.onclick=async n=>{n.preventDefault(),n.stopPropagation(),confirm("쮼liminar esta comparativa?")&&(window.StorageUtils&&window.StorageUtils.removeComparativa&&await window.StorageUtils.removeComparativa(t.id),i.remove(),0===document.querySelectorAll(".comparativa-item").length&&(e.innerHTML="<p>No hay comparativas guardadas.</p>"),window.StorageUtils?.showToast("Comparativa eliminada"),o())};const p=document.createElement("div");p.className="favorito-content",p.appendChild(s),p.appendChild(c),p.appendChild(l),i.appendChild(p),i.appendChild(m),n.appendChild(i)}),e.innerHTML="",e.appendChild(n)}document.addEventListener("DOMContentLoaded",async function(){!function(){const e=document.getElementById("account-skeleton"),t=document.querySelector("main");e&&(e.style.display="block"),t&&(t.style.display="none")}();try{const s=await e("backend/api/user.php");if(!s.ok)return void(window.location.href="/login");const r=await s.json().catch(()=>null),{data:c}=t(r),l=c||{};if(!l.id)return void(window.location.href="/login");const d=document.querySelector(".videos-board-topic");d&&(d.textContent=`Hola ${l.name||"Usuario"}`);const m=document.querySelector(".welcome-illustration img");m&&(l.avatar?(m.src=l.avatar,m.alt=`Avatar de ${l.name||"usuario"}`):(m.src="img/avatar-placeholder.svg",m.alt="Avatar predeterminado"));const p=document.getElementById("refreshFavoritos");p&&p.addEventListener("click",function(){const e=document.getElementById("favoritos-items-container");e&&(e.innerHTML=n,setTimeout(a,300))});const u=document.getElementById("refreshComparativas");u&&u.addEventListener("click",function(){const e=document.getElementById("lista-comparaciones");e&&(e.innerHTML=n,setTimeout(i,300))}),await Promise.all([a(),i()]),await o()}catch(e){console.error("Error al cargar la cuenta:",e);const t=document.querySelector("main");t&&(t.innerHTML='\n                <div class="api-error">\n                    <p>Ocurri칩 un problema al cargar tu cuenta. Intenta de nuevo m치s tarde.</p>\n                </div>')}finally{!function(){const e=document.getElementById("account-skeleton"),t=document.querySelector("main");e&&(e.style.display="none"),t&&(t.style.display="")}()}});
