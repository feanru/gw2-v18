import{b as r,n as t}from"./utils.min.js";import"./services.min.js";import"./config.min.js";async function e(){try{const e=await r("backend/api/favorites.php");if(!e.ok)return[];const a=await e.json().catch(()=>null),{data:o}=t(a);return Array.isArray(o)?o.map(r=>({id:parseInt(r,10)})):[]}catch(r){return console.error("Error obteniendo favoritos",r),[]}}async function a(){try{const e=await r("backend/api/comparisons.php");if(!e.ok)return[];const a=await e.json().catch(()=>null),{data:o}=t(a),i=r=>{if(!r)return[];try{return Array.isArray(r)?r:JSON.parse(r)}catch{return[]}},n=(r,t,e)=>{if(r)try{return(Array.isArray(r)?r:JSON.parse(r)).map(r=>Number(r))}catch{}return[Number(t),Number(e)].filter(r=>!isNaN(r))};return Array.isArray(o)?o.map(r=>({id:r.id,ids:n(r.item_ids,r.item_left,r.item_right),nombres:i(r.item_names)})):[]}catch(r){return console.error("Error obteniendo comparativas",r),[]}}window.StorageUtils={saveFavorito:async function(t){if(!t||!t.id)return[];try{await r("backend/api/favorites.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({item_id:t.id})})}catch(r){console.error("Error guardando favorito",r)}return navigator.serviceWorker?.controller?.postMessage({type:"invalidate",url:"backend/api/favorites.php"}),e()},getFavoritos:e,removeFavorito:async function(t){try{await r(`backend/api/favorites.php?item_id=${t}`,{method:"DELETE"})}catch(r){console.error("Error eliminando favorito",r)}return navigator.serviceWorker?.controller?.postMessage({type:"invalidate",url:"backend/api/favorites.php"}),e()},saveComparativa:async function(t){if(!t||!Array.isArray(t.ids)||t.ids.length<2)return[];try{await r("backend/api/comparisons.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({item_ids:t.ids,item_names:t.nombres})})}catch(r){console.error("Error guardando comparativa",r)}return navigator.serviceWorker?.controller?.postMessage({type:"invalidate",url:"backend/api/comparisons.php"}),a()},getComparativas:a,removeComparativa:async function(t){try{await r(`backend/api/comparisons.php?id=${t}`,{method:"DELETE"})}catch(r){console.error("Error eliminando comparativa",r)}return navigator.serviceWorker?.controller?.postMessage({type:"invalidate",url:"backend/api/comparisons.php"}),a()},showToast:function(r,t="success"){let e=document.getElementById("toast-container");e||(e=document.createElement("div"),e.id="toast-container",e.className="toast-container",document.body.appendChild(e));const a=document.createElement("div");a.className=`toast toast-${t}`,a.style.opacity="0",a.textContent=r,e.appendChild(a),setTimeout(()=>{a.style.opacity="1"},10),setTimeout(()=>{a.style.opacity="0",setTimeout(()=>{a.remove(),0===e.children.length&&e.remove()},300)},3e3)}};
