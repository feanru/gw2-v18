import{c as e,d as t}from"./utils.min.js";import"./config.min.js";import"./services.min.js";let n=null;async function a(){return n=await async function(){try{const n=await e("backend/api/user.php");if(!n.ok)return null;const a=await n.json().catch(()=>null),{data:i}=t(a);return i||null}catch(e){return null}}(),i(),n}function i(){document.dispatchEvent(new CustomEvent("auth-updated",{detail:n}))}window.Auth={get currentUser(){return n},initAuth:a,loginWithGoogle:function(){window.location.href="backend/auth.php?provider=google"},loginWithDiscord:function(){window.location.href="backend/auth.php?provider=discord"},logout:function(){n=null,i(),navigator.serviceWorker?.controller?.postMessage({type:"invalidateAll"}),window.location.href="backend/logout.php"},requireAuth:function(){return!!n||(window.location.href="/login",!1)}};const s={init(){this.theme=localStorage.getItem("theme")||"dark",this.applyTheme()},toggleTheme(){this.theme="dark"===this.theme?"light":"dark",localStorage.setItem("theme",this.theme),this.applyTheme()},applyTheme(){document.body.classList.toggle("light-theme","light"===this.theme),document.body.classList.toggle("dark-theme","dark"===this.theme);const e=document.getElementById("bg-video"),t=document.getElementById("bg-overlay");e&&e.classList.toggle("dark","dark"===this.theme),t&&(t.style.background="dark"===this.theme?"rgba(0,0,0,0.1)":"rgba(255,255,255,0.6)");document.querySelectorAll(".theme-toggle").forEach(e=>{e.textContent="dark"===this.theme?"ðŸŒ™":"â˜€ï¸"})}},o={menuItems:[{placement:"center",text:"Inicio",href:"/",target:"tab-detalles",class:"",submenu:null},{placement:"center",text:"Dones",href:"/dones",target:"tab-crafteo",class:"",submenu:null},{placement:"center",text:"Comparativa",href:"/compare-craft",target:"tab-comparativa",class:"",requiresLogin:!0,submenu:null},{placement:"center",text:"Legendarias",href:"/leg-craft",target:"tab-leg-craft",class:"",submenu:null},{placement:"center",text:"Bolsas",href:"/bag-craft",target:"tab-bag-craft",class:"",submenu:null},{placement:"center",text:"Datos",href:"#datos",target:"tab-datos",class:"",submenu:[{text:"Fractales",href:"/fractales-gold",target:"tab-fractales",requiresLogin:!0},{text:"Forja MÃ­stica",href:"/forja-mistica",target:"tab-forja-mistica"}]},{placement:"right",text:"ðŸŒ™",href:"#",target:"",class:"right-btn theme-toggle",id:"theme-toggle",closeOnNavigate:!0,onClick:e=>{e.preventDefault(),s.toggleTheme()}},{placement:"right",text:"Iniciar sesiÃ³n",href:"#",target:"",class:"right-btn",id:"loginBtn",onClick:e=>{e.preventDefault(),window.location.href="/login"}},{placement:"right",text:"",href:"#",target:"",class:"right-btn requires-login user-info-link",id:"userInfo",closeOnNavigate:!1,submenu:[{text:"Mi cuenta",href:"/cuenta"},{text:"Cerrar sesiÃ³n",href:"#",onClick:e=>{e.preventDefault(),window.Auth&&"function"==typeof window.Auth.logout&&window.Auth.logout()}}]}]};function r(){const e=document.getElementById("loginBtn"),t=document.getElementById("userInfo"),a=n,i=!!a;if(document.body.classList.toggle("logged-in",i),e&&e.classList.toggle("hidden",i),document.querySelectorAll("[data-requires-login]").forEach(e=>{e.classList.toggle("requires-login",!i)}),t){let e=t.querySelector(".item-text");e||(e=document.createElement("span"),e.className="item-text",t.appendChild(e));let n=t.querySelector("img.user-avatar");n||(n=document.createElement("img"),n.className="user-avatar",n.alt="avatar",n.style.width="24px",n.style.height="24px",n.style.borderRadius="50%",n.style.verticalAlign="middle",n.style.marginRight="5px",t.insertBefore(n,e)),i&&a?(n.style.display="",n.src=a.avatar||"img/avatar-placeholder.svg",n.alt=a.name||"avatar",e.textContent=a.name||"Usuario"):(n.style.display="none",n.removeAttribute("src"),e.textContent="")}const s=document.querySelector(".tab-button.active");if(s){const e=s.getAttribute("data-tab");e&&"function"==typeof window.switchTab&&window.switchTab(e)}}const l=(()=>{const e=new Set;let t=!1;const n=(t=null)=>{e.forEach(e=>{e!==t&&e.closeMenu()})},a=()=>{t||(t=!0,document.addEventListener("pointerdown",e=>{e.target.closest(".menu-item.has-submenu.is-open")||n()}),document.addEventListener("keydown",t=>{if("Escape"===t.key||"Esc"===t.key){const a=(()=>{for(const t of e)if(t.isOpen())return t;return null})();a&&(n(),a.link.focus(),t.preventDefault(),t.stopPropagation())}}))};return{register(t){e.add(t),a()},unregister(t){e.delete(t)},closeAllMenus:n,handleNavigation(){n()}}})();function c(){const e=document.createElement("nav");e.className="topbar item-tabs-bar";const t=(e,t="item-tab",n={})=>{const{closeOnNavigate:a}=n,i=e.closeOnNavigate??a??!0,s=document.createElement("a");if(s.href=e.href||"#",s.className=`${t} ${e.class||""}`.trim(),e.target&&s.setAttribute("data-target",e.target),e.id&&(s.id=e.id),e.requiresLogin&&s.classList.add("requires-login"),e.style&&s.setAttribute("style",e.style),e.onClick&&s.addEventListener("click",e.onClick),e.icon){const t=document.createElement("span");t.className="item-icon",t.textContent=e.icon,s.appendChild(t);const n=document.createElement("span");n.className="item-text",n.textContent=e.text||"",s.appendChild(n)}else s.textContent=e.text||"";return i&&s.addEventListener("click",()=>{l.handleNavigation()}),s},n=e=>{const n=document.createElement("div");n.className="menu-item";const a=t(e,"item-tab",{closeOnNavigate:!e.submenu&&e.closeOnNavigate});n.appendChild(a);const i=(e=>{if(!e)return null;const n=Array.isArray(e)?e:[e];if(!n.length)return null;const a=document.createElement("div");a.className="sub-menu";const i=(e,n,{defaultLinkClass:a}={})=>{if(!e)return!1;if("group"===e.type){const t=document.createElement("div");if(t.className=`submenu-group ${e.class||""}`.trim(),e.title){const n=document.createElement("div");n.className="submenu-group-title",n.textContent=e.title,t.appendChild(n)}const a=document.createElement("div");a.className="submenu-group-items";let s=!1;return(e.items||[]).forEach(e=>{s=i(e,a,{defaultLinkClass:"submenu-group-link"})||s}),!(!s&&!t.children.length||(t.appendChild(a),n.appendChild(t),0))}if("grid"===e.type||"grid"===e.layout){const t=document.createElement("div");t.className=`submenu-grid ${e.class||""}`.trim();const a=e.columns||e.items||[];let s=!1;const o=(e,t)=>{if(!e)return!1;const n=Array.isArray(e)?e:[e];let a=!1;return n.forEach(e=>{a=i(e,t,{defaultLinkClass:"submenu-grid-link"})||a}),a};return(Array.isArray(a)?a:[a]).forEach(e=>{if(!e)return;const n=document.createElement("div");if(n.className=`submenu-grid-column ${e.class||""}`.trim(),e.title||e.icon){const t=document.createElement("div");if(t.className="submenu-grid-title",e.icon){const n=document.createElement("span");n.className="submenu-grid-icon",n.textContent=e.icon,t.appendChild(n)}if(e.title){const n=document.createElement("span");n.className="submenu-grid-title-text",n.textContent=e.title,t.appendChild(n)}n.appendChild(t)}if(e.description){const t=document.createElement("div");t.className="submenu-grid-description",t.textContent=e.description,n.appendChild(t)}let a=!1;a=o(e.items,n)||a,a=o(e.links,n)||a,e.footer&&(a=o(e.footer,n)||a),(a||n.children.length)&&(t.appendChild(n),s=!0)}),!!s&&(n.appendChild(t),!0)}const s=(e.baseClass||a||"sub-menu-link").trim(),o=s?s.split(/\s+/):[];o.includes("item-tab")||o.push("item-tab"),o.includes("submenu-link")||o.push("submenu-link");const r=o.join(" "),l=t(e,r);return n.appendChild(l),!0};let s=!1;return n.forEach(e=>{s=i(e,a)||s}),s?a:null})(e.submenu);if(i){n.classList.add("has-submenu"),a.setAttribute("aria-haspopup","true"),a.setAttribute("aria-expanded","false"),n.appendChild(i);const e={link:a,menuItem:n,openMenu:()=>{l.closeAllMenus(e),n.classList.add("is-open"),a.setAttribute("aria-expanded","true")},closeMenu:()=>{n.classList.remove("is-open"),a.setAttribute("aria-expanded","false")},isOpen:()=>n.classList.contains("is-open")};l.register(e),n.addEventListener("pointerenter",e.openMenu),n.addEventListener("pointerleave",e.closeMenu),n.addEventListener("focusin",e.openMenu),n.addEventListener("focusout",t=>{n.contains(t.relatedTarget)||e.closeMenu()}),n.addEventListener("keydown",t=>{"Escape"!==t.key&&"Esc"!==t.key||n.classList.contains("is-open")&&(e.closeMenu(),a.focus(),t.preventDefault(),t.stopPropagation())}),a.addEventListener("click",t=>{t.preventDefault(),e.isOpen()?e.closeMenu():e.openMenu()})}return n},a=document.createElement("div");a.className="menu-center";const i=document.createElement("div");i.className="menu-right";const s=o.menuItems.reduce((e,t)=>(e["right"===t.placement?"right":"center"].push(t),e),{center:[],right:[]});return s.center.forEach(e=>{a.appendChild(n(e))}),s.right.forEach(e=>{i.appendChild(n(e))}),e.appendChild(a),e.appendChild(i),e}function u(){!function(){const e=document.querySelector("header");if(e){const t=c();e.insertBefore(t,e.firstChild),s.init(),r()}}(),a()}document.addEventListener("auth-updated",r),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",u):u(),window.updateAuthMenu=r,window.showAuthOptions=function(){let e=document.getElementById("auth-modal");e||(e=document.createElement("div"),e.id="auth-modal",e.className="modal-overlay",e.innerHTML='\n            <div class="auth-modal-content">\n                <h3 style=\'margin-bottom:18px;color:#fff;\'>Iniciar sesiÃ³n</h3>\n                <button id="google-login-btn" class="auth-btn google-btn">\n                    <img src="img/google-icon.svg" alt="google" onerror="this.onerror=null;this.src=\'img/icon-auth-fallback.svg\';"> Google\n                </button>\n                <button id="discord-login-btn" class="auth-btn discord-btn">\n                    <img src="img/discord-icon.svg" alt="discord" onerror="this.onerror=null;this.src=\'img/icon-auth-fallback.svg\';"> Discord\n                </button>\n                <a href="/login" class="auth-classic-link">Â¿Prefieres iniciar sesiÃ³n clÃ¡sico?</a>\n                <button onclick="document.getElementById(\'auth-modal\').remove()" class="auth-cancel-btn">Cancelar</button>\n            </div>',document.body.appendChild(e),document.getElementById("google-login-btn").onclick=()=>{window.Auth&&window.Auth.loginWithGoogle&&window.Auth.loginWithGoogle()},document.getElementById("discord-login-btn").onclick=()=>{window.Auth&&window.Auth.loginWithDiscord&&window.Auth.loginWithDiscord()})};
