import{c as t}from"./utils.min.js";import"./config.min.js";import"./services.min.js";!function(){const e=new Map,n=new Map,o={19676:1e4},a=[19675,19925,20796,19665,19674,19626,19672,19673,19645,19650,19655,19639,19635,19621,19633,19634,19641,19642,19628,20799],s=function(t){if(!t)return!1;const e=t.toLowerCase();return e.startsWith("don de ")||e.startsWith("don del ")||e.startsWith("don de la ")},r=function(t){return a.includes(t)},i=async function(n){if(e.has(n))return e.get(n);const o=sessionStorage.getItem("item:"+n);if(o){const t=JSON.parse(o);return e.set(n,t),t}const a=await t("https://api.guildwars2.com/v2/items/"+n);if(!a.ok)throw new Error("No se pudo obtener info de item "+n);const s=await a.json();e.set(n,s);try{sessionStorage.setItem("item:"+n,JSON.stringify(s))}catch(t){}return s},c=async function(e){if(void 0!==o[e]){const t=o[e];return{buys:{unit_price:t},sells:{unit_price:t}}}if(r(e))return null;if(n.has(e))return n.get(e);const a=sessionStorage.getItem("price:"+e);if(a){const t=JSON.parse(a);return n.set(e,t),t}const s=await t("https://api.guildwars2.com/v2/commerce/prices/"+e);if(!s.ok)return null;const i=await s.json();n.set(e,i);try{sessionStorage.setItem("price:"+e,JSON.stringify(i))}catch(t){}return i};"undefined"!=typeof window&&(window.DonesCore={fetchItemData:i,fetchPriceData:c,isGiftName:s,shouldSkipMarketCheck:r}),document.addEventListener("DOMContentLoaded",async function(){const t=new Set,e=new Map,n=Array.from(document.querySelectorAll(".tab-button[data-tab]")),o=Array.from(document.querySelectorAll(".tab-content")),a="activeDonTab",s="activeDonTabSessionReady",r=(()=>{try{return localStorage.getItem(a)}catch(t){return null}})(),i=(()=>{try{return"1"===sessionStorage.getItem(s)}catch(t){return!1}})();let c=n.find(t=>"tab-don-suerte"===t.getAttribute("data-tab"))||n[0];if(i&&r){const t=n.find(t=>t.getAttribute("data-tab")===r),e=r?document.getElementById(r):null;t&&e&&(c=t)}const d=c?c.getAttribute("data-tab"):null,u=d?document.getElementById(d):null;c&&u&&(n.forEach(t=>{const e=t===c;t.classList.toggle("active",e)}),o.forEach(t=>{const e=t===u;t.classList.toggle("active",e),t.style.display=e?"":"none"}));const l={"tab-don-suerte":()=>window.DonesPages.loadSpecialDons(),"tab-tributo-mistico":()=>window.DonesPages.loadTributo(),"tab-tributo-draconico":()=>window.DonesPages.loadDraconicTribute(),"dones-1ra-gen":()=>window.DonesPages.loadDones1Gen()};let g=i;const m=async n=>{if(!n)return;if((t=>{if(g&&t)try{localStorage.setItem(a,t),sessionStorage.setItem(s,"1")}catch(t){}})(n),t.has(n))return;if(e.has(n))return e.get(n);const o=(async()=>{try{await(async(t=2e3)=>{window.DonesPages||await new Promise((e,n)=>{const o=Date.now(),a=()=>{window.DonesPages?e():Date.now()-o>=t?n(new Error("DonesPages not ready")):setTimeout(a,50)};a()})})();const e=l[n];if(!e)return;await e(),t.add(n)}catch(t){console.error("Error loading tab content",n,t)}finally{e.delete(n)}})();return e.set(n,o),o};document.addEventListener("tabchange",t=>{const e=t&&t.detail?t.detail.tabId:void 0;!(!t||!t.detail)&&t.detail.userInitiated&&(g=!0),e&&m(e)}),await import("./tabs.min.js");let f=(()=>{const t=document.querySelector(".tab-content.active");return t?t.id:null})();if(f)await m(f);else if(n.length){const t=n[0].getAttribute("data-tab");await m(t)}})}();
