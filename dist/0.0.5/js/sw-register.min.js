document.addEventListener("DOMContentLoaded",()=>{"serviceWorker"in navigator&&(navigator.serviceWorker.addEventListener("message",e=>{if("reload"!==e.data?.type){if("cache-metrics"===e.data?.type){const t={...e.data.metrics||{}};Number.isFinite(t.lastUpdated)||(t.lastUpdated=Date.now()),window.__cacheMetrics__=t,"function"==typeof window.dispatchEvent&&"function"==typeof CustomEvent&&window.dispatchEvent(new CustomEvent("cache-metrics",{detail:t}))}}else alert("La página se actualizará para aplicar la nueva versión.")}),navigator.serviceWorker.register("/service-worker.min.js").then(()=>{window.cleanApiCache=()=>navigator.serviceWorker.controller?.postMessage({type:"clean"})}).catch(e=>console.error("SW registration failed",e)))});
